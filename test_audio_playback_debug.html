<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Playback Debug Test</title>
</head>
<body>
    <h1>Audio Playback Debug Test</h1>
    <button id="testButton">Test Audio Playback</button>
    <div id="output"></div>

    <script>
        const output = document.getElementById('output');
        const testButton = document.getElementById('testButton');

        function log(message) {
            output.innerHTML += '<div>' + message + '</div>';
            console.log(message);
        }

        function createTestWAV(sampleRate = 22050, duration = 1.0) {
            // Create a simple sine wave test tone
            const numSamples = Math.floor(sampleRate * duration);
            const audioData = new Int16Array(numSamples);
            
            // Generate a 440 Hz sine wave
            const frequency = 440;
            for (let i = 0; i < numSamples; i++) {
                const sample = Math.sin(2 * Math.PI * frequency * i / sampleRate);
                audioData[i] = Math.floor(sample * 16384); // Scale to 16-bit
            }

            // Create WAV header
            const wavHeader = new ArrayBuffer(44);
            const view = new DataView(wavHeader);
            
            // RIFF header
            view.setUint32(0, 0x52494646, false); // "RIFF"
            view.setUint32(4, 36 + audioData.byteLength, true); // File size - 8
            view.setUint32(8, 0x57415645, false); // "WAVE"
            
            // fmt chunk
            view.setUint32(12, 0x666D7420, false); // "fmt "
            view.setUint32(16, 16, true); // Chunk size
            view.setUint16(20, 1, true); // Audio format (PCM)
            view.setUint16(22, 1, true); // Channels
            view.setUint32(24, sampleRate, true); // Sample rate
            view.setUint32(28, sampleRate * 2, true); // Byte rate
            view.setUint16(32, 2, true); // Block align
            view.setUint16(34, 16, true); // Bits per sample
            
            // data chunk
            view.setUint32(36, 0x64617461, false); // "data"
            view.setUint32(40, audioData.byteLength, true); // Data size
            
            // Combine header and audio data
            const wavData = new Uint8Array(wavHeader.byteLength + audioData.byteLength);
            wavData.set(new Uint8Array(wavHeader), 0);
            wavData.set(new Uint8Array(audioData.buffer), wavHeader.byteLength);
            
            return wavData.buffer;
        }

        async function testAudioPlayback() {
            try {
                log('üéµ Starting audio playback test...');
                
                const audioContext = new AudioContext();
                log('üéµ Audio context sample rate: ' + audioContext.sampleRate + ' Hz');
                
                // Create test WAV data
                const wavData = createTestWAV(22050, 2.0);
                log('üéµ Created test WAV data: ' + wavData.byteLength + ' bytes');
                
                // Decode the audio
                const audioBuffer = await audioContext.decodeAudioData(wavData);
                log('üéµ Audio buffer decoded successfully');
                log('üéµ Audio buffer length: ' + audioBuffer.length + ' samples');
                log('üéµ Audio buffer duration: ' + audioBuffer.duration + ' seconds');
                log('üéµ Audio buffer sample rate: ' + audioBuffer.sampleRate + ' Hz');
                log('üéµ Audio buffer number of channels: ' + audioBuffer.numberOfChannels);
                
                // Play the audio
                const source = audioContext.createBufferSource();
                source.buffer = audioBuffer;
                source.connect(audioContext.destination);
                
                source.onended = () => {
                    log('üéµ Test audio playback completed');
                };
                
                source.start();
                log('üéµ Started playing test audio...');
                
            } catch (error) {
                log('‚ùå Error: ' + error.message);
                console.error('Audio test error:', error);
            }
        }

        testButton.addEventListener('click', testAudioPlayback);
    </script>
</body>
</html> 